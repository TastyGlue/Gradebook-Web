@page "/teacher/class-grades/{ClassId:guid}/{SubjectId:guid}"
@inherits ExtendedComponentBase

<PageTitle>Class Grades</PageTitle>

<MudPaper Class="pa-6 mx-auto mt-6" Style="max-width:800px;">
    <MudText Typo="Typo.h5" Class="mb-4">Grades & Absences</MudText>

    <!-- Info Bar: Class, Subject, Date -->
    <div class="mud-paper mud-elevation-0 pa-3 mb-4"
         style="display:flex; justify-content:space-between; align-items:center; background-color:var(--mud-palette-background); border-radius:4px;">
        <div>
            <MudText Typo="Typo.subtitle1">
                <strong>Class:</strong> 
            </MudText>
            <MudText Typo="Typo.subtitle1">
                <strong>Subject:</strong> 
            </MudText>
        </div>
        <MudText Typo="Typo.subtitle1">
            <strong>Date:</strong> 
        </MudText>
    </div>

    @if (_isLoading)
    {
        <MudProgressCircular Indeterminate="true" Class="mx-auto my-6" />
    }
    else
    {
        <MudTable Items="_students" Hover="true" Dense="true">
            <HeaderContent>
                <MudTh>Student</MudTh>
                <MudTh>Grades</MudTh>
                <MudTh>Absences</MudTh>
                <MudTh>Actions</MudTh>
            </HeaderContent>
            <RowTemplate Context="context">
                <MudTd>@(context.User?.FullName ?? "-")</MudTd>
                <MudTd>
                    @{
                        var vals = context.Grades?
                        .Where(g => g.Subject?.Id == SubjectId)
                        .Select(g => g.Value)
                        .ToList() ?? new List<decimal>();
                    }
                    @if (vals.Any())
                    {
                        @string.Join(", ", vals)
                    }
                    else
                    {
                        <em>No grades</em>
                    }
                </MudTd>
                <MudTd>@(context.Absences?.Count(a => !a.Excused) ?? 0)</MudTd>
                <MudTd>
                    <MudButton Href="@(string.Format("/teacher/add-grade/{0}/{1}", context.Id, SubjectId))"
                               Variant="Variant.Outlined"
                               Size="Size.Small"
                               Color="Color.Primary">
                        Add Grade
                    </MudButton>
                </MudTd>
            </RowTemplate>
        </MudTable>
    }
</MudPaper>